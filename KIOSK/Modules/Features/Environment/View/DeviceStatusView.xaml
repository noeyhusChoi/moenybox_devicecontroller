<UserControl
    x:Class="KIOSK.Modules.Features.Environment.View.DeviceStatusView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="Transparent">
    <UserControl.Resources>
        <Style x:Key="CardStyle" TargetType="Border">
            <Setter Property="Background" Value="#F9FAFB" />
            <Setter Property="BorderBrush" Value="#E5E7EB" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="14" />
            <Setter Property="Padding" Value="14" />
        </Style>

        <Style x:Key="SectionHeaderStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="13" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Margin" Value="0,0,0,6" />
        </Style>

        <Style x:Key="LabelStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="12" />
            <Setter Property="Foreground" Value="#6B7280" />
        </Style>
        <Style x:Key="ValueStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="12" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Foreground" Value="#111827" />
        </Style>

        <Style x:Key="ButtonGhost" TargetType="Button">
            <Setter Property="Background" Value="#FFFFFF" />
            <Setter Property="Foreground" Value="#374151" />
            <Setter Property="BorderBrush" Value="#E5E7EB" />
            <Setter Property="BorderThickness" Value="1.2" />
            <Setter Property="FontSize" Value="12" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Height" Value="28" />
            <Setter Property="Padding" Value="10,0" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border
                            Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            CornerRadius="12">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <Border
        Width="1280"
        MaxHeight="960"
        VerticalAlignment="Center"
        Background="White"
        CornerRadius="20">
        <Grid Margin="24">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <Grid Grid.Row="0" Margin="0,0,0,12">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <TextBlock FontSize="18" FontWeight="Bold" Text="장치 상태 상세" />
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button
                        Margin="0,0,8,0"
                        Command="{Binding RefreshCommand}"
                        Content="새로고침"
                        Style="{StaticResource ButtonGhost}" />
                    <Button
                        Command="{Binding BackCommand}"
                        Content="뒤로"
                        Style="{StaticResource ButtonGhost}" />
                </StackPanel>
            </Grid>

            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2.4*" />
                    <ColumnDefinition Width="12" />
                    <ColumnDefinition Width="3.6*" />
                </Grid.ColumnDefinitions>

                <!-- Left: Device list -->
                <Border Grid.Column="0" Style="{StaticResource CardStyle}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        <TextBlock Style="{StaticResource SectionHeaderStyle}" Text="장치 목록" />
                        <ListBox
                            Grid.Row="1"
                            ItemsSource="{Binding Devices}"
                            SelectedItem="{Binding SelectedDevice}"
                            BorderThickness="0"
                            Background="#F9FAFB">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <Border
                                        Margin="0,0,0,6"
                                        Padding="10,8"
                                        Background="#FFFFFF"
                                        BorderBrush="#E5E7EB"
                                        BorderThickness="1"
                                        CornerRadius="10">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>
                                            <StackPanel>
                                                <TextBlock FontWeight="SemiBold" Text="{Binding Name}" />
                                                <TextBlock FontSize="11" Foreground="#6B7280" Text="{Binding Model}" />
                                            </StackPanel>
                                            <StackPanel Grid.Column="1" Orientation="Horizontal">
                                                <TextBlock
                                                    Margin="0,0,6,0"
                                                    FontSize="11"
                                                    Foreground="#6B7280"
                                                    Text="{Binding AlertCount, StringFormat=Alerts {0}}" />
                                                <TextBlock FontSize="11" Foreground="#111827" Text="{Binding Health}" />
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </Grid>
                </Border>

                <!-- Right: Details -->
                <StackPanel Grid.Column="2">
                    <Border Style="{StaticResource CardStyle}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>
                            <TextBlock Style="{StaticResource SectionHeaderStyle}" Text="장치 정보" />
                            <UniformGrid Grid.Row="1" Columns="2" Margin="0,6,0,0">
                                <StackPanel Margin="0,0,0,6">
                                    <TextBlock Style="{StaticResource LabelStyle}" Text="Vendor" />
                                    <TextBlock Style="{StaticResource ValueStyle}" Text="{Binding SelectedDevice.Vendor}" />
                                </StackPanel>
                                <StackPanel Margin="0,0,0,6">
                                    <TextBlock Style="{StaticResource LabelStyle}" Text="Model" />
                                    <TextBlock Style="{StaticResource ValueStyle}" Text="{Binding SelectedDevice.Model}" />
                                </StackPanel>
                                <StackPanel Margin="0,0,0,6">
                                    <TextBlock Style="{StaticResource LabelStyle}" Text="DriverKey" />
                                    <TextBlock Style="{StaticResource ValueStyle}" Text="{Binding SelectedDevice.DriverKey}" />
                                </StackPanel>
                                <StackPanel Margin="0,0,0,6">
                                    <TextBlock Style="{StaticResource LabelStyle}" Text="DeviceKey" />
                                    <TextBlock Style="{StaticResource ValueStyle}" Text="{Binding SelectedDevice.DeviceKey}" />
                                </StackPanel>
                                <StackPanel Margin="0,0,0,6">
                                    <TextBlock Style="{StaticResource LabelStyle}" Text="Transport" />
                                    <TextBlock Style="{StaticResource ValueStyle}" Text="{Binding SelectedDevice.TransportType}" />
                                </StackPanel>
                                <StackPanel Margin="0,0,0,6">
                                    <TextBlock Style="{StaticResource LabelStyle}" Text="Port" />
                                    <TextBlock Style="{StaticResource ValueStyle}" Text="{Binding SelectedDevice.TransportPort}" />
                                </StackPanel>
                                <StackPanel Margin="0,0,0,6">
                                    <TextBlock Style="{StaticResource LabelStyle}" Text="Param" />
                                    <TextBlock Style="{StaticResource ValueStyle}" Text="{Binding SelectedDevice.TransportParam}" />
                                </StackPanel>
                                <StackPanel Margin="0,0,0,6">
                                    <TextBlock Style="{StaticResource LabelStyle}" Text="Polling(ms)" />
                                    <TextBlock Style="{StaticResource ValueStyle}" Text="{Binding SelectedDevice.PollingMs}" />
                                </StackPanel>
                            </UniformGrid>
                            <Grid Grid.Row="2" Margin="0,10,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0">
                                    <TextBlock Style="{StaticResource LabelStyle}" Text="Health" />
                                    <TextBlock Style="{StaticResource ValueStyle}" Text="{Binding SelectedDevice.Health}" />
                                </StackPanel>
                                <StackPanel Grid.Column="1">
                                    <TextBlock Style="{StaticResource LabelStyle}" Text="Updated" />
                                    <TextBlock Style="{StaticResource ValueStyle}" Text="{Binding SelectedDevice.Timestamp}" />
                                </StackPanel>
                            </Grid>
                        </Grid>
                    </Border>

                    <Border Style="{StaticResource CardStyle}" Margin="0,8,0,0">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>
                            <TextBlock Style="{StaticResource SectionHeaderStyle}" Text="알람 상세" />
                            <DataGrid
                                Grid.Row="1"
                                AutoGenerateColumns="False"
                                CanUserAddRows="False"
                                CanUserDeleteRows="False"
                                CanUserResizeRows="False"
                                CanUserSortColumns="False"
                                HeadersVisibility="Column"
                                GridLinesVisibility="None"
                                ItemsSource="{Binding SelectedDevice.Alerts}">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Binding="{Binding Code}" Header="Code" Width="*" />
                                    <DataGridTextColumn Binding="{Binding Severity}" Header="Severity" Width="90" />
                                    <DataGridTextColumn Binding="{Binding Message}" Header="Message" Width="2*" />
                                    <DataGridTextColumn Binding="{Binding At}" Header="At" Width="150" />
                                </DataGrid.Columns>
                            </DataGrid>
                        </Grid>
                    </Border>

                    <Border Style="{StaticResource CardStyle}" Margin="0,8,0,0">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>
                            <TextBlock Style="{StaticResource SectionHeaderStyle}" Text="지원 명령" />
                            <DataGrid
                                Grid.Row="1"
                                AutoGenerateColumns="False"
                                CanUserAddRows="False"
                                CanUserDeleteRows="False"
                                CanUserResizeRows="False"
                                CanUserSortColumns="False"
                                HeadersVisibility="Column"
                                GridLinesVisibility="None"
                                ItemsSource="{Binding Commands}">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Binding="{Binding Name}" Header="Command" Width="*" />
                                    <DataGridTextColumn Binding="{Binding Description}" Header="Description" Width="2*" />
                                </DataGrid.Columns>
                            </DataGrid>
                        </Grid>
                    </Border>
                </StackPanel>
            </Grid>
        </Grid>
    </Border>
</UserControl>
